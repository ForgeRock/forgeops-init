{
  "metadata" : {
    "realm" : null,
    "amsterVersion" : "14.0.0-SNAPSHOT",
    "entityType" : "GlobalScripts",
    "entityId" : "36863ffb-40ec-48b9-94b1-9a99f71cc3b5",
    "pathParams" : { }
  },
  "data" : {
    "_id" : "36863ffb-40ec-48b9-94b1-9a99f71cc3b5",
    "lastModifiedDate" : "1490105312427",
    "createdBy" : "id=dsameuser,ou=user,dc=openam,dc=forgerock,dc=org",
    "lastModifiedBy" : "id=amadmin,ou=user,dc=openam,dc=forgerock,dc=org",
    "name" : "OIDC Claims Script",
    "context" : "OIDC_CLAIMS",
    "description" : "Default global script for OIDC claims",
    "language" : "GROOVY",
    "creationDate" : "1433147666269",
    "script" : "LyoKKiBUaGUgY29udGVudHMgb2YgdGhpcyBmaWxlIGFyZSBzdWJqZWN0IHRvIHRoZSB0ZXJtcyBvZiB0aGUgQ29tbW9uIERldmVsb3BtZW50IGFuZAoqIERpc3RyaWJ1dGlvbiBMaWNlbnNlICh0aGUgTGljZW5zZSkuIFlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUKKiBMaWNlbnNlLgoqCiogWW91IGNhbiBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0IGxlZ2FsL0NEREx2MS4wLnR4dC4gU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUKKiBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbiBhbmQgbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCioKKiBXaGVuIGRpc3RyaWJ1dGluZyBDb3ZlcmVkIFNvZnR3YXJlLCBpbmNsdWRlIHRoaXMgQ0RETCBIZWFkZXIgTm90aWNlIGluIGVhY2ggZmlsZSBhbmQgaW5jbHVkZQoqIHRoZSBMaWNlbnNlIGZpbGUgYXQgbGVnYWwvQ0RETHYxLjAudHh0LiBJZiBhcHBsaWNhYmxlLCBhZGQgdGhlIGZvbGxvd2luZyBiZWxvdyB0aGUgQ0RETAoqIEhlYWRlciwgd2l0aCB0aGUgZmllbGRzIGVuY2xvc2VkIGJ5IGJyYWNrZXRzIFtdIHJlcGxhY2VkIGJ5IHlvdXIgb3duIGlkZW50aWZ5aW5nCiogaW5mb3JtYXRpb246ICJQb3J0aW9ucyBjb3B5cmlnaHQgW3llYXJdIFtuYW1lIG9mIGNvcHlyaWdodCBvd25lcl0iLgoqCiogQ29weXJpZ2h0IDIwMTQtMjAxNiBGb3JnZVJvY2sgQVMuCiovCmltcG9ydCBjb20uaXBsYW5ldC5zc28uU1NPRXhjZXB0aW9uCmltcG9ydCBjb20uc3VuLmlkZW50aXR5LmlkbS5JZFJlcG9FeGNlcHRpb24KaW1wb3J0IG9yZy5mb3JnZXJvY2sub2F1dGgyLmNvcmUuVXNlckluZm9DbGFpbXMKCi8qCiogRGVmaW5lZCB2YXJpYWJsZXM6CiogbG9nZ2VyIC0gYWx3YXlzIHByZXNlbnRzLCB0aGUgIk9BdXRoMlByb3ZpZGVyIiBkZWJ1ZyBsb2dnZXIgaW5zdGFuY2UKKiBjbGFpbXMgLSBhbHdheXMgcHJlc2VudCwgZGVmYXVsdCBzZXJ2ZXIgcHJvdmlkZWQgY2xhaW1zCiogc2Vzc2lvbiAtIHByZXNlbnQgaWYgdGhlIHJlcXVlc3QgY29udGFpbnMgdGhlIHNlc3Npb24gY29va2llLCB0aGUgdXNlcidzIHNlc3Npb24gb2JqZWN0CiogaWRlbnRpdHkgLSBhbHdheXMgcHJlc2VudCwgdGhlIGlkZW50aXR5IG9mIHRoZSByZXNvdXJjZSBvd25lcgoqIHNjb3BlcyAtIGFsd2F5cyBwcmVzZW50LCB0aGUgcmVxdWVzdGVkIHNjb3BlcwoqIHJlcXVlc3RlZENsYWltcyAtIE1hcDxTdHJpbmcsIFNldDxTdHJpbmc+PgoqICAgICAgICAgICAgICAgICAgYWx3YXlzIHByZXNlbnQsIG5vdCBlbXB0eSBpZiB0aGUgcmVxdWVzdCBjb250YWlucyBhIGNsYWltcyBwYXJhbWV0ZXIgYW5kIHNlcnZlciBoYXMgZW5hYmxlZAoqICAgICAgICAgICAgICAgICAgY2xhaW1zX3BhcmFtZXRlcl9zdXBwb3J0ZWQsIG1hcCBvZiByZXF1ZXN0ZWQgY2xhaW1zIHRvIHBvc3NpYmxlIHZhbHVlcywgb3RoZXJ3aXNlIGVtcHR5LAoqICAgICAgICAgICAgICAgICAgcmVxdWVzdGVkIGNsYWltcyB3aXRoIG5vIHJlcXVlc3RlZCB2YWx1ZXMgd2lsbCBoYXZlIGEga2V5IGJ1dCBubyB2YWx1ZSBpbiB0aGUgbWFwLiBBIGtleSB3aXRoCiogICAgICAgICAgICAgICAgICBhIHNpbmdsZSB2YWx1ZSBpbiBpdHMgU2V0IGluZGljYXRlcyB0aGlzIGlzIHRoZSBvbmx5IHZhbHVlIHRoYXQgc2hvdWxkIGJlIHJldHVybmVkLgoqIFJlcXVpcmVkIHRvIHJldHVybiBhIE1hcCBvZiBjbGFpbXMgdG8gYmUgYWRkZWQgdG8gdGhlIGlkX3Rva2VuIGNsYWltcwoqCiogRXhwZWN0ZWQgcmV0dXJuIHZhbHVlIHN0cnVjdHVyZToKKiBVc2VySW5mb0NsYWltcyB7CiogICAgTWFwPFN0cmluZywgT2JqZWN0PiB2YWx1ZXM7IC8vIFRoZSB2YWx1ZXMgb2YgdGhlIGNsYWltcyBmb3IgdGhlIHVzZXIgaW5mb3JtYXRpb24KKiAgICBNYXA8U3RyaW5nLCBMaXN0PFN0cmluZz4+IGNvbXBvc2l0ZVNjb3BlczsgLy8gTWFwcGluZyBvZiBzY29wZSBuYW1lIHRvIGEgbGlzdCBvZiBjbGFpbSBuYW1lcy4KKiB9CiovCgovLyB1c2VyIHNlc3Npb24gbm90IGd1YXJhbnRlZWQgdG8gYmUgcHJlc2VudApib29sZWFuIHNlc3Npb25QcmVzZW50ID0gc2Vzc2lvbiAhPSBudWxsCgpkZWYgZnJvbVNldCA9IHsgY2xhaW0sIGF0dHIgLT4KICAgIGlmIChhdHRyICE9IG51bGwgJiYgYXR0ci5zaXplKCkgPT0gMSl7CiAgICAgICAgYXR0ci5pdGVyYXRvcigpLm5leHQoKQogICAgfSBlbHNlIGlmIChhdHRyICE9IG51bGwgJiYgYXR0ci5zaXplKCkgPiAxKXsKICAgICAgICBhdHRyCiAgICB9IGVsc2UgaWYgKGxvZ2dlci53YXJuaW5nRW5hYmxlZCgpKSB7CiAgICAgICAgbG9nZ2VyLndhcm5pbmcoIk9wZW5BTVNjb3BlVmFsaWRhdG9yLmdldFVzZXJJbmZvKCk6IEdvdCBhbiBlbXB0eSByZXN1bHQgZm9yIGNsYWltPSRjbGFpbSIpOwogICAgfQp9CgphdHRyaWJ1dGVSZXRyaWV2ZXIgPSB7IGF0dHJpYnV0ZSwgY2xhaW0sIGlkZW50aXR5LCByZXF1ZXN0ZWQgLT4KICAgIGlmIChyZXF1ZXN0ZWQgPT0gbnVsbCB8fCByZXF1ZXN0ZWQuaXNFbXB0eSgpKSB7CiAgICAgICAgZnJvbVNldChjbGFpbSwgaWRlbnRpdHkuZ2V0QXR0cmlidXRlKGF0dHJpYnV0ZSkpCiAgICB9IGVsc2UgaWYgKHJlcXVlc3RlZC5zaXplKCkgPT0gMSkgewogICAgICAgIHJlcXVlc3RlZC5pdGVyYXRvcigpLm5leHQoKQogICAgfSBlbHNlIHsKICAgICAgICB0aHJvdyBuZXcgUnVudGltZUV4Y2VwdGlvbigiTm8gc2VsZWN0aW9uIGxvZ2ljIGZvciAkY2xhaW0gZGVmaW5lZC4gVmFsdWVzOiAkcmVxdWVzdGVkIikKICAgIH0KfQoKLy8gWyB7Y2xhaW19OiB7YXR0cmlidXRlIHJldHJpZXZlcn0sIC4uLiBdCmNsYWltQXR0cmlidXRlcyA9IFsKICAgICAgICAiZW1haWwiOiBhdHRyaWJ1dGVSZXRyaWV2ZXIuY3VycnkoIm1haWwiKSwKICAgICAgICAiYWRkcmVzcyI6IHsgY2xhaW0sIGlkZW50aXR5LCByZXF1ZXN0ZWQgLT4gWyAiZm9ybWF0dGVkIiA6IGF0dHJpYnV0ZVJldHJpZXZlcigicG9zdGFsYWRkcmVzcyIsIGNsYWltLCBpZGVudGl0eSwgcmVxdWVzdGVkKSBdIH0sCiAgICAgICAgInBob25lX251bWJlciI6IGF0dHJpYnV0ZVJldHJpZXZlci5jdXJyeSgidGVsZXBob25lbnVtYmVyIiksCiAgICAgICAgImdpdmVuX25hbWUiOiBhdHRyaWJ1dGVSZXRyaWV2ZXIuY3VycnkoImdpdmVubmFtZSIpLAogICAgICAgICJ6b25laW5mbyI6IGF0dHJpYnV0ZVJldHJpZXZlci5jdXJyeSgicHJlZmVycmVkdGltZXpvbmUiKSwKICAgICAgICAiZmFtaWx5X25hbWUiOiBhdHRyaWJ1dGVSZXRyaWV2ZXIuY3VycnkoInNuIiksCiAgICAgICAgImxvY2FsZSI6IGF0dHJpYnV0ZVJldHJpZXZlci5jdXJyeSgicHJlZmVycmVkbG9jYWxlIiksCiAgICAgICAgIm5hbWUiOiBhdHRyaWJ1dGVSZXRyaWV2ZXIuY3VycnkoImNuIikKXQoKLy8ge3Njb3BlfTogWyB7Y2xhaW19LCAuLi4gXQpzY29wZUNsYWltc01hcCA9IFsKICAgICAgICAiZW1haWwiOiBbICJlbWFpbCIgXSwKICAgICAgICAiYWRkcmVzcyI6IFsgImFkZHJlc3MiIF0sCiAgICAgICAgInBob25lIjogWyAicGhvbmVfbnVtYmVyIiBdLAogICAgICAgICJwcm9maWxlIjogWyAiZ2l2ZW5fbmFtZSIsICJ6b25laW5mbyIsICJmYW1pbHlfbmFtZSIsICJsb2NhbGUiLCAibmFtZSIgXQpdCgppZiAobG9nZ2VyLm1lc3NhZ2VFbmFibGVkKCkpIHsKICAgIHNjb3Blcy5maW5kQWxsIHsgcyAtPiAhKCJvcGVuaWQiLmVxdWFscyhzKSB8fCBzY29wZUNsYWltc01hcC5jb250YWluc0tleShzKSkgfS5lYWNoIHsgcyAtPgogICAgICAgIGxvZ2dlci5tZXNzYWdlKCJPcGVuQU1TY29wZVZhbGlkYXRvci5nZXRVc2VySW5mbygpOjpNZXNzYWdlOiBzY29wZSBub3QgYm91bmQgdG8gY2xhaW1zOiAkcyIpCiAgICB9Cn0KCmRlZiBjb21wdXRlQ2xhaW0gPSB7IGNsYWltLCByZXF1ZXN0ZWRWYWx1ZXMgLT4KICAgIHRyeSB7CiAgICAgICAgWyBjbGFpbSwgY2xhaW1BdHRyaWJ1dGVzLmdldChjbGFpbSkoY2xhaW0sIGlkZW50aXR5LCByZXF1ZXN0ZWRWYWx1ZXMpIF0KICAgIH0gY2F0Y2ggKElkUmVwb0V4Y2VwdGlvbiBlKSB7CiAgICAgICAgaWYgKGxvZ2dlci53YXJuaW5nRW5hYmxlZCgpKSB7CiAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKCJPcGVuQU1TY29wZVZhbGlkYXRvci5nZXRVc2VySW5mbygpOiBVbmFibGUgdG8gcmV0cmlldmUgYXR0cmlidXRlPSRhdHRyaWJ1dGUiLCBlKTsKICAgICAgICB9CiAgICB9IGNhdGNoIChTU09FeGNlcHRpb24gZSkgewogICAgICAgIGlmIChsb2dnZXIud2FybmluZ0VuYWJsZWQoKSkgewogICAgICAgICAgICBsb2dnZXIud2FybmluZygiT3BlbkFNU2NvcGVWYWxpZGF0b3IuZ2V0VXNlckluZm8oKTogVW5hYmxlIHRvIHJldHJpZXZlIGF0dHJpYnV0ZT0kYXR0cmlidXRlIiwgZSk7CiAgICAgICAgfQogICAgfQp9CgpkZWYgY29tcHV0ZWRDbGFpbXMgPSBzY29wZXMuZmluZEFsbCB7IHMgLT4gISJvcGVuaWQiLmVxdWFscyhzKSAmJiBzY29wZUNsYWltc01hcC5jb250YWluc0tleShzKSB9LmluamVjdChjbGFpbXMpIHsgbWFwLCBzIC0+CiAgICBzY29wZUNsYWltcyA9IHNjb3BlQ2xhaW1zTWFwLmdldChzKQogICAgbWFwIDw8IHNjb3BlQ2xhaW1zLmZpbmRBbGwgeyBjIC0+ICFyZXF1ZXN0ZWRDbGFpbXMuY29udGFpbnNLZXkoYykgfS5jb2xsZWN0RW50cmllcyhbOl0pIHsgY2xhaW0gLT4gY29tcHV0ZUNsYWltKGNsYWltLCBudWxsKSB9Cn0uZmluZEFsbCB7IG1hcCAtPiBtYXAudmFsdWUgIT0gbnVsbCB9IDw8IHJlcXVlc3RlZENsYWltcy5jb2xsZWN0RW50cmllcyhbOl0pIHsgY2xhaW0sIHJlcXVlc3RlZFZhbHVlIC0+CiAgICBjb21wdXRlQ2xhaW0oY2xhaW0sIHJlcXVlc3RlZFZhbHVlKQp9CgpkZWYgY29tcG9zaXRlU2NvcGVzID0gc2NvcGVDbGFpbXNNYXAuZmluZEFsbCB7IHNjb3BlIC0+CiAgICBzY29wZXMuY29udGFpbnMoc2NvcGUua2V5KQp9CgpyZXR1cm4gbmV3IFVzZXJJbmZvQ2xhaW1zKChNYXApY29tcHV0ZWRDbGFpbXMsIChNYXApY29tcG9zaXRlU2NvcGVzKQ==",
    "_type" : {
      "_id" : "globalScript",
      "name" : "Scripting",
      "collection" : true
    }
  }
}