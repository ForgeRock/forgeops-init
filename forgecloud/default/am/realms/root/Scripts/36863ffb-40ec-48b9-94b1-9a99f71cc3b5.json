{
  "metadata": {
    "realm": "/",
    "amsterVersion": "&{version}",
    "entityType": "Scripts",
    "entityId": "36863ffb-40ec-48b9-94b1-9a99f71cc3b5",
    "pathParams": {}
  },
  "data": {
    "_id": "36863ffb-40ec-48b9-94b1-9a99f71cc3b5",
    "name": "OIDC Claims Script",
    "description": "Default global script for OIDC claims",
    "script": "LyoKICogQ29weXJpZ2h0IDIwMTQtMjAxNyBGb3JnZVJvY2sgQVMuIEFsbCBSaWdodHMgUmVzZXJ2ZWQKICoKICogVXNlIG9mIHRoaXMgY29kZSByZXF1aXJlcyBhIGNvbW1lcmNpYWwgc29mdHdhcmUgbGljZW5zZSB3aXRoIEZvcmdlUm9jayBBUy4KICogb3Igd2l0aCBvbmUgb2YgaXRzIGFmZmlsaWF0ZXMuIEFsbCB1c2Ugc2hhbGwgYmUgZXhjbHVzaXZlbHkgc3ViamVjdAogKiB0byBzdWNoIGxpY2Vuc2UgYmV0d2VlbiB0aGUgbGljZW5zZWUgYW5kIEZvcmdlUm9jayBBUy4KICovCmltcG9ydCBjb20uaXBsYW5ldC5zc28uU1NPRXhjZXB0aW9uCmltcG9ydCBjb20uc3VuLmlkZW50aXR5LmlkbS5JZFJlcG9FeGNlcHRpb24KaW1wb3J0IG9yZy5mb3JnZXJvY2sub2F1dGgyLmNvcmUuZXhjZXB0aW9ucy5JbnZhbGlkUmVxdWVzdEV4Y2VwdGlvbgppbXBvcnQgb3JnLmZvcmdlcm9jay5vYXV0aDIuY29yZS5Vc2VySW5mb0NsYWltcwppbXBvcnQgb3JnLmZvcmdlcm9jay5vcGVuaWRjb25uZWN0LkNsYWltCmltcG9ydCBncm9vdnkuanNvbi5Kc29uU2x1cnBlcgppbXBvcnQgZ3Jvb3Z5Lmpzb24uaW50ZXJuYWwuTGF6eU1hcAoKLyoKKiBEZWZpbmVkIHZhcmlhYmxlczoKKiBsb2dnZXIgLSBhbHdheXMgcHJlc2VudHMsIHRoZSAiT0F1dGgyUHJvdmlkZXIiIGRlYnVnIGxvZ2dlciBpbnN0YW5jZQoqIGNsYWltcyAtIGFsd2F5cyBwcmVzZW50LCBkZWZhdWx0IHNlcnZlciBwcm92aWRlZCBjbGFpbXMgLSBNYXA8U3RyaW5nLCBPYmplY3Q+CiogY2xhaW1PYmplY3RzIC0gYWx3YXlzIHByZXNlbnQsIGRlZmF1bHQgc2VydmVyIHByb3ZpZGVkIGNsYWltcyAtIExpc3Q8Q2xhaW0+Ciogc2Vzc2lvbiAtIHByZXNlbnQgaWYgdGhlIHJlcXVlc3QgY29udGFpbnMgdGhlIHNlc3Npb24gY29va2llLCB0aGUgdXNlcidzIHNlc3Npb24gb2JqZWN0CiogaWRlbnRpdHkgLSBhbHdheXMgcHJlc2VudCwgdGhlIGlkZW50aXR5IG9mIHRoZSByZXNvdXJjZSBvd25lcgoqIHNjb3BlcyAtIGFsd2F5cyBwcmVzZW50LCB0aGUgcmVxdWVzdGVkIHNjb3BlcwoqIHJlcXVlc3RlZENsYWltcyAtIE1hcDxTdHJpbmcsIFNldDxTdHJpbmc+PgoqICAgICAgICAgICAgICAgICAgYWx3YXlzIHByZXNlbnQsIG5vdCBlbXB0eSBpZiB0aGUgcmVxdWVzdCBjb250YWlucyBhIGNsYWltcyBwYXJhbWV0ZXIgYW5kIHNlcnZlciBoYXMgZW5hYmxlZAoqICAgICAgICAgICAgICAgICAgY2xhaW1zX3BhcmFtZXRlcl9zdXBwb3J0ZWQsIG1hcCBvZiByZXF1ZXN0ZWQgY2xhaW1zIHRvIHBvc3NpYmxlIHZhbHVlcywgb3RoZXJ3aXNlIGVtcHR5LAoqICAgICAgICAgICAgICAgICAgcmVxdWVzdGVkIGNsYWltcyB3aXRoIG5vIHJlcXVlc3RlZCB2YWx1ZXMgd2lsbCBoYXZlIGEga2V5IGJ1dCBubyB2YWx1ZSBpbiB0aGUgbWFwLiBBIGtleSB3aXRoCiogICAgICAgICAgICAgICAgICBhIHNpbmdsZSB2YWx1ZSBpbiBpdHMgU2V0IGluZGljYXRlcyB0aGlzIGlzIHRoZSBvbmx5IHZhbHVlIHRoYXQgc2hvdWxkIGJlIHJldHVybmVkLgoqIHJlcXVlc3RlZFR5cGVkQ2xhaW1zIC0gTGlzdDxDbGFpbT4KKiAgICAgICAgICAgICAgICAgICAgICAgYWx3YXlzIHByZXNlbnQsIG5vdCBlbXB0eSBpZiB0aGUgcmVxdWVzdCBjb250YWlucyBhIGNsYWltcyBwYXJhbWV0ZXIgYW5kIHNlcnZlciBoYXMgZW5hYmxlZAoqICAgICAgICAgICAgICAgICAgICAgICBjbGFpbXNfcGFyYW1hdGVyX3N1cHBvcnRlZCwgbGlzdCBvZiByZXF1ZXN0ZWQgY2xhaW1zIHdpdGggY2xhaW0gbmFtZSwgcmVxdWVzdGVkIHBvc3NpYmxlIHZhbHVlcwoqICAgICAgICAgICAgICAgICAgICAgICBhbmQgaWYgY2xhaW0gaXMgZXNzZW50aWFsLCBvdGhlcndpc2UgZW1wdHksCiogICAgICAgICAgICAgICAgICAgICAgIHJlcXVlc3RlZCBjbGFpbXMgd2l0aCBubyByZXF1ZXN0ZWQgdmFsdWVzIHdpbGwgaGF2ZSBhIGNsYWltIHdpdGggbm8gdmFsdWVzLiBBIGNsYWltcyB3aXRoCiogICAgICAgICAgICAgICAgICAgICAgIGEgc2luZ2xlIHZhbHVlIGluZGljYXRlcyB0aGlzIGlzIHRoZSBvbmx5IHZhbHVlIHRoYXQgc2hvdWxkIGJlIHJldHVybmVkLgoqIGNsYWltc0xvY2FsZXMgLSB0aGUgdmFsdWVzIGZyb20gdGhlICdjbGFpbXNfbG9jYWxlcycgcGFyYW1ldGVyIC0gTGlzdDxTdHJpbmc+CiogUmVxdWlyZWQgdG8gcmV0dXJuIGEgTWFwIG9mIGNsYWltcyB0byBiZSBhZGRlZCB0byB0aGUgaWRfdG9rZW4gY2xhaW1zCioKKiBFeHBlY3RlZCByZXR1cm4gdmFsdWUgc3RydWN0dXJlOgoqIFVzZXJJbmZvQ2xhaW1zIHsKKiAgICBNYXA8U3RyaW5nLCBPYmplY3Q+IHZhbHVlczsgLy8gVGhlIHZhbHVlcyBvZiB0aGUgY2xhaW1zIGZvciB0aGUgdXNlciBpbmZvcm1hdGlvbgoqICAgIE1hcDxTdHJpbmcsIExpc3Q8U3RyaW5nPj4gY29tcG9zaXRlU2NvcGVzOyAvLyBNYXBwaW5nIG9mIHNjb3BlIG5hbWUgdG8gYSBsaXN0IG9mIGNsYWltIG5hbWVzLgoqIH0KKi8KCi8vIHVzZXIgc2Vzc2lvbiBub3QgZ3VhcmFudGVlZCB0byBiZSBwcmVzZW50CmJvb2xlYW4gc2Vzc2lvblByZXNlbnQgPSBzZXNzaW9uICE9IG51bGwKCi8qCiAqIFB1bGxzIGZpcnN0IHZhbHVlIGZyb20gdXNlcnMgcHJvZmlsZSBhdHRyaWJ1dGUKICoKICogQHBhcmFtIGNsYWltIFRoZSBjbGFpbSBvYmplY3QuCiAqIEBwYXJhbSBhdHRyIFRoZSBwcm9maWxlIGF0dHJpYnV0ZSBuYW1lLgogKi8KZGVmIGZyb21TZXQgPSB7IGNsYWltLCBhdHRyIC0+CiAgICBpZiAoYXR0ciAhPSBudWxsICYmIGF0dHIuc2l6ZSgpID09IDEpewogICAgICAgIGF0dHIuaXRlcmF0b3IoKS5uZXh0KCkKICAgIH0gZWxzZSBpZiAoYXR0ciAhPSBudWxsICYmIGF0dHIuc2l6ZSgpID4gMSl7CiAgICAgICAgYXR0cgogICAgfSBlbHNlIGlmIChsb2dnZXIud2FybmluZ0VuYWJsZWQoKSkgewogICAgICAgIGxvZ2dlci53YXJuaW5nKCJPcGVuQU1TY29wZVZhbGlkYXRvci5nZXRVc2VySW5mbygpOiBHb3QgYW4gZW1wdHkgcmVzdWx0IGZvciBjbGFpbT0kY2xhaW0iKTsKICAgIH0KfQoKLy8gLS0tdnZ2dnZ2dnZ2di0tLSBFWEFNUExFIENMQUlNIEFUVFJJQlVURSBSRVNPTFZFUiBGVU5DVElPTlMgLS0tdnZ2dnZ2dnZ2di0tLQovKgogKiBDbGFpbSByZXNvbHZlciB3aGljaCByZXNvbHZlcyB0aGUgdmFsdWUgb2YgdGhlIGNsYWltIGZyb20gaXRzIHJlcXVlc3RlZCB2YWx1ZXMuCiAqCiAqIFRoaXMgcmVzb2x2ZXIgd2lsbCByZXR1cm4gYSB2YWx1ZSBpZiB0aGUgY2xhaW0gaGFzIG9uZSByZXF1ZXN0ZWQgdmFsdWVzLCBvdGhlcndpc2UgYW4gZXhjZXB0aW9uIGlzIHRocm93bi4KICovCmRlZmF1bHRDbGFpbVJlc29sdmVyID0geyBjbGFpbSAtPgogICAgaWYgKGNsYWltLmdldFZhbHVlcygpLnNpemUoKSA9PSAxKSB7CiAgICAgICAgWyhjbGFpbS5nZXROYW1lKCkpOiBjbGFpbS5nZXRWYWx1ZXMoKS5pdGVyYXRvcigpLm5leHQoKV0KICAgIH0gZWxzZSB7CiAgICAgICAgWzpdCiAgICB9Cn0KCi8qCiAqIENsYWltIHJlc29sdmVyIHdoaWNoIHJlc29sdmVzIHRoZSB2YWx1ZSBvZiB0aGUgY2xhaW0gYnkgbG9va2luZyB1cCB0aGUgdXNlcidzIHByb2ZpbGUuCiAqCiAqIFRoaXMgcmVzb2x2ZXIgd2lsbCByZXR1cm4gYSB2YWx1ZSBmb3IgdGhlIGNsYWltIGlmOgogKiAjIHRoZSB1c2VyJ3MgcHJvZmlsZSBhdHRyaWJ1dGUgaXMgbm90IG51bGwKICogIyBBTkQgdGhlIGNsYWltIGNvbnRhaW5zIG5vIHJlcXVlc3RlZCB2YWx1ZXMKICogIyBPUiB0aGUgY2xhaW0gY29udGFpbnMgcmVxdWVzdGVkIHZhbHVlcyBhbmQgdGhlIHZhbHVlIGZyb20gdGhlIHVzZXIncyBwcm9maWxlIGlzIGluIHRoZSBsaXN0IG9mIHZhbHVlcwogKgogKiBJZiBubyBtYXRjaCBpcyBmb3VuZCBhbiBleGNlcHRpb24gaXMgdGhyb3duLgogKi8KCm5hbWVSZXNvbHZlciA9IHsgYXR0cmlidXRlLCBjbGFpbSwgaWRlbnRpdHkgLT4KICAgIHVzZXJQcm9maWxlVmFsdWUgPSBmcm9tU2V0KGNsYWltLmdldE5hbWUoKSwgaWRlbnRpdHkuZ2V0QXR0cmlidXRlKGF0dHJpYnV0ZSkpCiAgICBpZiAodXNlclByb2ZpbGVWYWx1ZSAhPSBudWxsICYmIChjbGFpbS5nZXRWYWx1ZXMoKSA9PSBudWxsIHx8IGNsYWltLmdldFZhbHVlcygpLmlzRW1wdHkoKSB8fCBjbGFpbS5nZXRWYWx1ZXMoKS5jb250YWlucyh1c2VyUHJvZmlsZVZhbHVlKSkpIHsKICAgICAgICBkZWYgdmFsdWUgPSB0b0pzb24odXNlclByb2ZpbGVWYWx1ZSkKICAgICAgICAvLyBAdG9kbyBuYW1lIGluY2x1ZGluZyBhbGwgbmFtZSBwYXJ0cywgcG9zc2libHkgaW5jbHVkaW5nIHRpdGxlcyBhbmQgc3VmZml4ZXMsIG9yZGVyZWQgYWNjb3JkaW5nIHRvIHRoZSBFbmQtVXNlcidzIGxvY2FsZSBhbmQgcHJlZmVyZW5jZXMuCiAgICAgICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgZ3Jvb3Z5Lmpzb24uaW50ZXJuYWwuTGF6eU1hcCkgewogICAgICAgICAgCWlmICh2YWx1ZS5naXZlbk5hbWUgJiYgdmFsdWUuZmFtaWx5TmFtZSAmJiB2YWx1ZS5taWRkbGVOYW1lKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gWwogICAgICAgICAgICAgICAgICAgICJmYW1pbHlfbmFtZSI6IHZhbHVlLmZhbWlseU5hbWUsCiAgICAgICAgICAgICAgICAgICAgImdpdmVuX25hbWUiOiB2YWx1ZS5naXZlbk5hbWUsCiAgICAgICAgICAgICAgICAgIAkibWlkZGxlX25hbWUiOiB2YWx1ZS5taWRkbGVOYW1lLAogICAgICAgICAgICAgICAgICAgICJuYW1lIjogIiR2YWx1ZS5naXZlbk5hbWUgJHZhbHVlLm1pZGRsZU5hbWUgJHZhbHVlLmZhbWlseU5hbWUiLnRyaW0oKSwKICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgfSBlbHNlIGlmICh2YWx1ZS5naXZlbk5hbWUgJiYgdmFsdWUuZmFtaWx5TmFtZSkgewogICAgICAgICAgICAgICAgcmV0dXJuIFsKICAgICAgICAgICAgICAgICAgICAiZmFtaWx5X25hbWUiOiB2YWx1ZS5mYW1pbHlOYW1lLAogICAgICAgICAgICAgICAgICAgICJnaXZlbl9uYW1lIjogdmFsdWUuZ2l2ZW5OYW1lLAogICAgICAgICAgICAgICAgICAgICJuYW1lIjogIiR2YWx1ZS5naXZlbk5hbWUgJHZhbHVlLmZhbWlseU5hbWUiLnRyaW0oKSwKICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgfSBlbHNlIGlmICh2YWx1ZS5mYW1pbHlOYW1lKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gWwogICAgICAgICAgICAgICAgICAgICJmYW1pbHlfbmFtZSI6IHZhbHVlLmZhbWlseU5hbWUsCiAgICAgICAgICAgICAgICAgICAgIm5hbWUiOiB2YWx1ZS5mYW1pbHlOYW1lLAogICAgICAgICAgICAgICAgXQogICAgICAgICAgICB9IGVsc2UgaWYgKHZhbHVlLmdpdmVuTmFtZSkgewogICAgICAgICAgICAgICAgcmV0dXJuIFsKICAgICAgICAgICAgICAgICAgICAiZ2l2ZW5fbmFtZSI6IHZhbHVlLmdpdmVuTmFtZSwKICAgICAgICAgICAgICAgICAgICAibmFtZSI6IHZhbHVlLmdpdmVuTmFtZSwKICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gWwogICAgICAgICAgICAgICAgIm5hbWUiOiB2YWx1ZSwKICAgICAgICAgICAgXQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBbCiAgICAgICAgICAgICAgICAibmFtZSI6IHZhbHVlLAogICAgICAgICAgICBdCiAgICAgICAgfQogICAgfQogICAgWzpdCn0KCmFkZHJlc3NSZXNvbHZlciA9IHsgYXR0cmlidXRlLCBjbGFpbSwgaWRlbnRpdHkgLT4KICAJZGVmIG5hbWUgPSBjbGFpbS5nZXROYW1lKCkKICAgIGxvZ2dlci5tZXNzYWdlKCJhZGRyZXNzUmVzb2x2ZXI6ICIgKyBuYW1lKQogICAgCiAgCWRlZiBqc29uVmFsdWUgPSBmcm9tU2V0KG5hbWUsIGlkZW50aXR5LmdldEF0dHJpYnV0ZShhdHRyaWJ1dGUpKQoJaWYgKGpzb25WYWx1ZSA9PSBudWxsKSB7CiAgICAJcmV0dXJuIFs6XQogIAl9CiAgCiAgCWRlZiBhZGRyZXNzID0gdG9Kc29uKGpzb25WYWx1ZSkKCiAgCS8vIENyZWF0ZSBpbmRpdmlkdWFsIHByb3BlcnRpZXMKICAJZGVmIG1hcCA9IFs6XQogIAlpZiAoYWRkcmVzcy5zdHJlZXRBZGRyZXNzKSB7CiAgICAJbWFwLnB1dCgic3RyZWV0X2FkZHJlc3MiLCBhZGRyZXNzLnN0cmVldEFkZHJlc3MpCiAgCX0KICAJaWYgKGFkZHJlc3MubG9jYWxpdHkpIHsKICAgIAltYXAucHV0KCJsb2NhbGl0eSIsIGFkZHJlc3MubG9jYWxpdHkpCiAgCX0KICAJaWYgKGFkZHJlc3MucmVnaW9uKSB7CiAgICAJbWFwLnB1dCgicmVnaW9uIiwgYWRkcmVzcy5yZWdpb24pCiAgCX0KICAJaWYgKGFkZHJlc3MucG9zdGFsQ29kZSkgewogICAgCW1hcC5wdXQoInBvc3RhbF9jb2RlIiwgYWRkcmVzcy5wb3N0YWxDb2RlKQogIAl9CiAgCWlmIChhZGRyZXNzLmNvdW50cnkpIHsKICAgIAltYXAucHV0KCJjb3VudHJ5IiwgYWRkcmVzcy5jb3VudHJ5KQogIAl9CiAgCiAgCS8vIENyZWF0ZSBmb3JtYXR0ZWQgYWRkcmVzcwogIAlkZWYgZm9ybWF0dGVkID0gW10KICAJZGVmIGxvY2FsaXR5UmVnaW9uU2VwID0gIiwgIgogIAlpZiAoIWFkZHJlc3MubG9jYWxpdHkgfHwgIWFkZHJlc3MucmVnaW9uKSB7CiAgICAJbG9jYWxpdHlSZWdpb25TZXAgPSAiIgogIAl9CiAgCWlmIChhZGRyZXNzLnN0cmVldEFkZHJlc3MpIHsKICAgICAgCWZvcm1hdHRlZCA8PCBhZGRyZXNzLnN0cmVldEFkZHJlc3MKICAJfQogIAlpZiAoYWRkcmVzcy5sb2NhbGl0eSB8fCBhZGRyZXNzLnJlZ2lvbiB8fCBhZGRyZXNzLnBvc3RhbENvZGUpIHsKICAgIAlmb3JtYXR0ZWQgPDwgKGFkZHJlc3MubG9jYWxpdHkgKyBsb2NhbGl0eVJlZ2lvblNlcCArIGFkZHJlc3MucmVnaW9uICsgIiAiICsgYWRkcmVzcy5wb3N0YWxDb2RlKS50cmltKCkKICAJfQogIAlpZiAoYWRkcmVzcy5jb3VudHJ5KSB7CiAgICAJZm9ybWF0dGVkIDw8IGFkZHJlc3MuY291bnRyeQogIAl9CiAgCWlmIChmb3JtYXR0ZWQuc2l6ZSgpID4gMCkgewogICAgCW1hcC5wdXQoImZvcm1hdHRlZCIsIGZvcm1hdHRlZC5qb2luKCJcbiIpKQogIAl9CiAgICAgICAgICAgICAgCiAgIAlyZXR1cm4gW2FkZHJlc3M6IG1hcF0KfQoKYXR0cmlidXRlUmVzb2x2ZXIgPSB7IGF0dHJpYnV0ZSwgZmllbGQsIHVzZVByaW1hcnksIGFkZFZlcmlmaWVkLCBjbGFpbSwgaWRlbnRpdHkgLT4KICAJbmFtZSA9IGNsYWltLmdldE5hbWUoKQogICAgbG9nZ2VyLm1lc3NhZ2UoImF0dHJpYnV0ZVJlc29sdmVyOiAiICsgbmFtZSkKICAKICAgIHZhbHVlID0gZnJvbVNldChuYW1lLCBpZGVudGl0eS5nZXRBdHRyaWJ1dGUoYXR0cmlidXRlKSkKCiAgCWlmICh2YWx1ZSAhPSBudWxsICYmIChjbGFpbS5nZXRWYWx1ZXMoKSA9PSBudWxsIHx8IGNsYWltLmdldFZhbHVlcygpLmlzRW1wdHkoKSB8fCBjbGFpbS5nZXRWYWx1ZXMoKS5jb250YWlucyh2YWx1ZSkpKSB7CiAgICAgICAgdmFsdWUgPSB0b0pzb24odmFsdWUpCiAgICAgICAgaWYgKHVzZVByaW1hcnkpIHsKICAgICAgICAgICAgdmFsdWUgPSBnZXRQcmltYXJ5T3JGaXJzdCh2YWx1ZSkKICAgICAgICB9CiAgICAgIAogICAgICAgCWlzTWFwID0gdmFsdWUgIT0gbnVsbCAmJiB2YWx1ZSBpbnN0YW5jZW9mIExhenlNYXAKICAgICAgIAloYXNGaWVsZCA9IGlzTWFwICYmIGZpZWxkIGluc3RhbmNlb2YgU3RyaW5nICYmIHZhbHVlLmNvbnRhaW5zS2V5KGZpZWxkKQogICAgICAJaGFzVmVyaWZpZWQgPSBpc01hcCAmJiB2YWx1ZS5jb250YWluc0tleSgidmVyaWZpZWQiKQoKICAgICAgCWlmIChhZGRWZXJpZmllZCAmJiBoYXNWZXJpZmllZCkgeyAgICAgICAgICAJCiAgICAgICAgICAgIHJldHVybiBbCiAgICAgICAgICAgICAgICAobmFtZSArICJfdmVyaWZpZWQiKTogaGFzVmVyaWZpZWQgJiYgdmFsdWUudmVyaWZpZWQgPT0gdHJ1ZSwKICAgICAgICAgICAgICAgIChuYW1lKTogaGFzRmllbGQgPyB2YWx1ZVtmaWVsZF0gOiB2YWx1ZSwKICAgICAgICAgICAgXQogICAgICAgIH0KICAgICAgCiAgICAgICAgcmV0dXJuIFsKICAgICAgICAgICAgKG5hbWUpOiBoYXNGaWVsZCA/IHZhbHVlW2ZpZWxkXSA6IHZhbHVlLAogICAgICAgIF0KICAgIH0KICAgIFs6XQp9CgpiYXNpY1Jlc29sdmVyID0geyBhdHRyaWJ1dGUsIGNsYWltLCBpZGVudGl0eSAtPgogICAgbmFtZSA9IGNsYWltLmdldE5hbWUoKQogICAgbG9nZ2VyLm1lc3NhZ2UoImJhc2ljUmVzb2x2ZXI6ICIgKyBuYW1lKQogICAgdXNlclByb2ZpbGVWYWx1ZSA9IGZyb21TZXQobmFtZSwgaWRlbnRpdHkuZ2V0QXR0cmlidXRlKGF0dHJpYnV0ZSkpCiAgICBpZiAodXNlclByb2ZpbGVWYWx1ZSAhPSBudWxsICYmIChjbGFpbS5nZXRWYWx1ZXMoKSA9PSBudWxsIHx8IGNsYWltLmdldFZhbHVlcygpLmlzRW1wdHkoKSB8fCBjbGFpbS5nZXRWYWx1ZXMoKS5jb250YWlucyh1c2VyUHJvZmlsZVZhbHVlKSkpIHsKICAgICAgICBkZWYgdmFsdWUgPSB0b0pzb24odXNlclByb2ZpbGVWYWx1ZSkKICAgICAgICB2YWx1ZSA9IGdldFByaW1hcnlPckZpcnN0KHZhbHVlKQogICAgICAgIHJldHVybiBbKG5hbWUpOiB2YWx1ZV0KICAgIH0KICAgIFs6XQp9CgpkYXRlUmVzb2x2ZXIgPSB7IGF0dHJpYnV0ZSwgY2xhaW0sIGlkZW50aXR5IC0+CiAgICBuYW1lID0gY2xhaW0uZ2V0TmFtZSgpCiAgICBsb2dnZXIubWVzc2FnZSgiZGF0ZVJlc29sdmVyOiAiICsgbmFtZSkKICAgIHVzZXJQcm9maWxlVmFsdWUgPSBmcm9tU2V0KG5hbWUsIGlkZW50aXR5LmdldEF0dHJpYnV0ZShhdHRyaWJ1dGUpKQogICAgaWYgKHVzZXJQcm9maWxlVmFsdWUgIT0gbnVsbCAmJiAoY2xhaW0uZ2V0VmFsdWVzKCkgPT0gbnVsbCB8fCBjbGFpbS5nZXRWYWx1ZXMoKS5pc0VtcHR5KCkgfHwgY2xhaW0uZ2V0VmFsdWVzKCkuY29udGFpbnModXNlclByb2ZpbGVWYWx1ZSkpKSB7CiAgICAgIAlkZWYgdmFsdWUgPSB0b0pzb24odXNlclByb2ZpbGVWYWx1ZSkKICAgICAgCXZhbHVlID0gZ2V0UHJpbWFyeU9yRmlyc3QodmFsdWUpCiAgICAgIAlkZWYgZGF0ZSA9IERhdGUucGFyc2UoInl5eXlNTWRkSEhtbXNzIiwgdmFsdWUpOwoJCXJldHVybiBbKG5hbWUpOiBkYXRlLnRpbWUgLyAxMDAwXQogICAgfQogICAgWzpdCn0KCmdldFByaW1hcnlPckZpcnN0ID0geyB2YWx1ZSAtPgogICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgamF2YS51dGlsLkFycmF5TGlzdCkgewogICAgICAgIC8vIGxvb2sgZm9yIHByaW1hcnkKICAgICAgICBmb3IgKGl0ZW0gaW4gdmFsdWUpIHsKICAgICAgICAgIAlvYmogPSB0b0pzb24oaXRlbSkKICAgICAgICAgICAgaWYgKG9iai5oYXNQcm9wZXJ0eSgicHJpbWFyeSIpICYmIG9iai5wcmltYXJ5ID09IHRydWUpIHsKICAgICAgICAgICAgICAgIHJldHVybiBvYmoKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAvLyByZXR1cm4gZmlyc3QKICAgICAgICByZXR1cm4gdG9Kc29uKHZhbHVlWzBdKQogICAgfQogICAgcmV0dXJuIHZhbHVlCn0KCnRvSnNvbiA9IHsgdmFsdWUgLT4KICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIGphdmEudXRpbC5IYXNoU2V0KSB7CiAgICAgICAgZGVmIGpzb25TZXQgPSBbXQogICAgICAgIHZhbHVlLmVhY2ggeyBpIC0+CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBqc29uU2V0LmFkZCh0b0pzb24oaSkpCiAgICAgICAgICAgIH0gY2F0Y2goZSkgewogICAgICAgICAgICAgICAganNvblNldC5hZGQoaSkKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgcmV0dXJuIGpzb25TZXQKICAgIH0KICAgIHRyeSB7CiAgICAgICAgcmV0dXJuIG5ldyBKc29uU2x1cnBlcigpLnBhcnNlVGV4dCh2YWx1ZSkKICAgIH0gY2F0Y2goZSkgewogICAgICAgIHJldHVybiB2YWx1ZQogICAgfQp9CgoKLyoKICogQ2xhaW0gcmVzb2x2ZXIgd2hpY2ggcmVzb2x2ZXMgdGhlIHZhbHVlIG9mIHRoZSBjbGFpbSBieSBsb29raW5nIHVwIHRoZSB1c2VyJ3MgcHJvZmlsZS4KICoKICogVGhpcyByZXNvbHZlciB3aWxsIHJldHVybiBhIHZhbHVlIGZvciB0aGUgY2xhaW0gaWY6CiAqICMgdGhlIHVzZXIncyBwcm9maWxlIGF0dHJpYnV0ZSBpcyBub3QgbnVsbAogKiAjIEFORCB0aGUgY2xhaW0gY29udGFpbnMgbm8gcmVxdWVzdGVkIHZhbHVlcwogKiAjIE9SIHRoZSBjbGFpbSBjb250YWlucyByZXF1ZXN0ZWQgdmFsdWVzIGFuZCB0aGUgdmFsdWUgZnJvbSB0aGUgdXNlcidzIHByb2ZpbGUgaXMgaW4gdGhlIGxpc3Qgb2YgdmFsdWVzCiAqCiAqIElmIHRoZSBjbGFpbSBpcyBlc3NlbnRpYWwgYW5kIG5vIHZhbHVlIGlzIGZvdW5kIGFuIEludmFsaWRSZXF1ZXN0RXhjZXB0aW9uIHdpbGwgYmUgdGhyb3duIGFuZCByZXR1cm5lZCB0byB0aGUgdXNlci4KICogSWYgbm8gbWF0Y2ggaXMgZm91bmQgYW4gZXhjZXB0aW9uIGlzIHRocm93bi4KICovCmVzc2VudGlhbENsYWltUmVzb2x2ZXIgPSB7IGF0dHJpYnV0ZSwgY2xhaW0sIGlkZW50aXR5IC0+CiAgICB1c2VyUHJvZmlsZVZhbHVlID0gZnJvbVNldChjbGFpbS5nZXROYW1lKCksIGlkZW50aXR5LmdldEF0dHJpYnV0ZShhdHRyaWJ1dGUpKQogICAgaWYgKGNsYWltLmlzRXNzZW50aWFsKCkgJiYgKHVzZXJQcm9maWxlVmFsdWUgPT0gbnVsbCB8fCB1c2VyUHJvZmlsZVZhbHVlLmlzRW1wdHkoKSkpIHsKICAgICAgICB0aHJvdyBuZXcgSW52YWxpZFJlcXVlc3RFeGNlcHRpb24oIkNvdWxkIG5vdCBwcm92aWRlIHZhbHVlIGZvciBlc3NlbnRpYWwgY2xhaW0gJGNsYWltIikKICAgIH0KICAgIGlmICh1c2VyUHJvZmlsZVZhbHVlICE9IG51bGwgJiYgKGNsYWltLmdldFZhbHVlcygpID09IG51bGwgfHwgY2xhaW0uZ2V0VmFsdWVzKCkuaXNFbXB0eSgpIHx8IGNsYWltLmdldFZhbHVlcygpLmNvbnRhaW5zKHVzZXJQcm9maWxlVmFsdWUpKSkgewogICAgICAgIHJldHVybiBbKGNsYWltLmdldE5hbWUoKSk6IHVzZXJQcm9maWxlVmFsdWVdCiAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBbOl0KICAgIH0KfQoKLyoKICogQ2xhaW0gcmVzb2x2ZXIgd2hpY2ggZXhwZWN0cyB0aGUgdXNlcidzIHByb2ZpbGUgYXR0cmlidXRlIHZhbHVlIHRvIGJlIGluIHRoZSBmb2xsb3dpbmcgZm9ybWF0OgogKiAibGFuZ3VhZ2VfdGFnfHZhbHVlX2Zvcl9sYW5ndWFnZSwuLi4iLgogKgogKiBUaGlzIHJlc29sdmVyIHdpbGwgdGFrZSB0aGUgbGlzdCBvZiByZXF1ZXN0ZWQgbGFuZ3VhZ2VzIGZyb20gdGhlICdjbGFpbXNfbG9jYWxlcycgYXV0aG9yaXplIHJlcXVlc3QKICogcGFyYW1ldGVyIGFuZCBhdHRlbXB0IHRvIG1hdGNoIGl0IHRvIGEgdmFsdWUgZnJvbSB0aGUgdXNlcnMnIHByb2ZpbGUgYXR0cmlidXRlLgogKiBJZiBubyBtYXRjaCBpcyBmb3VuZCBhbiBleGNlcHRpb24gaXMgdGhyb3duLgogKi8KY2xhaW1Mb2NhbGVzQ2xhaW1SZXNvbHZlciA9IHsgYXR0cmlidXRlLCBjbGFpbSwgaWRlbnRpdHkgLT4KICAgIHVzZXJQcm9maWxlVmFsdWUgPSBmcm9tU2V0KGNsYWltLmdldE5hbWUoKSwgaWRlbnRpdHkuZ2V0QXR0cmlidXRlKGF0dHJpYnV0ZSkpCiAgICBpZiAodXNlclByb2ZpbGVWYWx1ZSAhPSBudWxsKSB7CiAgICAgICAgbG9jYWxlVmFsdWVzID0gcGFyc2VMb2NhbGVBd2FyZVN0cmluZyh1c2VyUHJvZmlsZVZhbHVlKQogICAgICAgIGxvY2FsZSA9IGNsYWltc0xvY2FsZXMuZmluZCB7IGxvY2FsZSAtPiBsb2NhbGVWYWx1ZXMuY29udGFpbnNLZXkobG9jYWxlKSB9CiAgICAgICAgaWYgKGxvY2FsZSAhPSBudWxsKSB7CiAgICAgICAgICAgIHJldHVybiBbKGNsYWltLmdldE5hbWUoKSk6IGxvY2FsZVZhbHVlcy5nZXQobG9jYWxlKV0KICAgICAgICB9CiAgICB9CiAgICByZXR1cm4gWzpdCn0KCi8qCiAqIENsYWltIHJlc29sdmVyIHdoaWNoIGV4cGVjdHMgdGhlIHVzZXIncyBwcm9maWxlIGF0dHJpYnV0ZSB2YWx1ZSB0byBiZSBpbiB0aGUgZm9sbG93aW5nIGZvcm1hdDoKICogImxhbmd1YWdlX3RhZ3x2YWx1ZV9mb3JfbGFuZ3VhZ2UsLi4uIi4KICoKICogVGhpcyByZXNvbHZlciB3aWxsIHRha2UgdGhlIGxhbmd1YWdlIHRhZyBzcGVjaWZpZWQgaW4gdGhlIGNsYWltIG9iamVjdCBhbmQgYXR0ZW1wdCB0byBtYXRjaCBpdCB0byBhIHZhbHVlCiAqIGZyb20gdGhlIHVzZXJzJyBwcm9maWxlIGF0dHJpYnV0ZS4gSWYgbm8gbWF0Y2ggaXMgZm91bmQgYW4gZXhjZXB0aW9uIGlzIHRocm93bi4KICovCmxhbmd1YWdlVGFnQ2xhaW1SZXNvbHZlciA9IHsgYXR0cmlidXRlLCBjbGFpbSwgaWRlbnRpdHkgLT4KICAgIHVzZXJQcm9maWxlVmFsdWUgPSBmcm9tU2V0KGNsYWltLmdldE5hbWUoKSwgaWRlbnRpdHkuZ2V0QXR0cmlidXRlKGF0dHJpYnV0ZSkpCiAgICBpZiAodXNlclByb2ZpbGVWYWx1ZSAhPSBudWxsKSB7CiAgICAgICAgbG9jYWxlVmFsdWVzID0gcGFyc2VMb2NhbGVBd2FyZVN0cmluZyh1c2VyUHJvZmlsZVZhbHVlKQogICAgICAgIGlmIChjbGFpbS5nZXRMb2NhbGUoKSAhPSBudWxsKSB7CiAgICAgICAgICAgIGlmIChsb2NhbGVWYWx1ZXMuY29udGFpbnNLZXkoY2xhaW0uZ2V0TG9jYWxlKCkpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gWyhjbGFpbS5nZXROYW1lKCkpOiBsb2NhbGVWYWx1ZXMuZ2V0KGNsYWltLmdldExvY2FsZSgpKV0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGVudHJ5ID0gbG9jYWxlVmFsdWVzLmVudHJ5U2V0KCkuaXRlcmF0b3IoKS5uZXh0KCkKICAgICAgICAgICAgICAgIHJldHVybiBbKGNsYWltLmdldE5hbWUoKSArICIjIiArIGVudHJ5LmdldEtleSgpKTogZW50cnkuZ2V0VmFsdWUoKV0KICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGVudHJ5ID0gbG9jYWxlVmFsdWVzLmVudHJ5U2V0KCkuaXRlcmF0b3IoKS5uZXh0KCkKICAgICAgICAgICAgcmV0dXJuIFsoY2xhaW0uZ2V0TmFtZSgpKTogZW50cnkuZ2V0VmFsdWUoKV0KICAgICAgICB9CiAgICB9CiAgICByZXR1cm4gWzpdCn0KCi8qCiAqIEdpdmVuIGEgc3RyaW5nICJlbnxFbmdsaXNoLGpwfEphcGVuZXNlLGZyX0NBfEZyZW5jaCBDYW5hZGlhbiIgd2lsbCByZXR1cm4gbWFwIG9mIGxvY2FsZSAtPiB2YWx1ZS4KICovCnBhcnNlTG9jYWxlQXdhcmVTdHJpbmcgPSB7IHMgLT4KICAgIHJldHVybiByZXN1bHQgPSBzLnNwbGl0KCIsIikuY29sbGVjdEVudHJpZXMgeyBlbnRyeSAtPgogICAgICAgIHNwbGl0ID0gZW50cnkuc3BsaXQoIlxcfCIpCiAgICAgICAgWyhzcGxpdFswXSk6IHZhbHVlID0gc3BsaXRbMV1dCiAgICB9Cn0KLy8gLS0tXl5eXl5eXl5eXi0tLSBFWEFNUExFIENMQUlNIEFUVFJJQlVURSBSRVNPTFZFUiBGVU5DVElPTlMgLS0tXl5eXl5eXl5eXi0tLQoKLy8gLS0tLS0tLS0tLS0tLS0gVVBEQVRFIFRISVMgVE8gQ0hBTkdFIENMQUlNIFRPIEFUVFJJQlVURSBNQVBQSU5HIEZVTkNUSU9OUyAtLS0tLS0tLS0tLS0tLS0KLyoKICogTGlzdCBvZiBjbGFpbSByZXNvbHZlciBtYXBwaW5ncy4KICovCi8vIFsge2NsYWltfToge2F0dHJpYnV0ZSByZXRyaWV2ZXJ9LCAuLi4gXQpjbGFpbUF0dHJpYnV0ZXMgPSBbCiAgICAgICAgImFkZHJlc3MiOiBhZGRyZXNzUmVzb2x2ZXIuY3VycnkoImZyLWlkbS1hZGRyZXNzZXMiKSwKICAgICAgICAiYmlydGhkYXRlIjogYmFzaWNSZXNvbHZlci5jdXJyeSgiZnItaWRtLWJpcnRoZGF0ZSIpLAogICAgICAgICJlbWFpbCI6IGF0dHJpYnV0ZVJlc29sdmVyLmN1cnJ5KCJmci1pZG0tZW1haWxzIiwgInZhbHVlIiwgdHJ1ZSwgdHJ1ZSksCiAgICAgICAgImdlbmRlciI6IGJhc2ljUmVzb2x2ZXIuY3VycnkoImZyLWlkbS1nZW5kZXIiKSwKICAgICAgICAibG9jYWxlIjogYmFzaWNSZXNvbHZlci5jdXJyeSgiZnItaWRtLWxvY2FsZSIpLAogICAgICAgICJuYW1lIjogbmFtZVJlc29sdmVyLmN1cnJ5KCJmci1pZG0tbmFtZS1vYmplY3QiKSwKICAgICAgICAibmlja25hbWUiOiBiYXNpY1Jlc29sdmVyLmN1cnJ5KCJmci1pZG0tbmljay1uYW1lIiksCiAgICAgICAgInBob25lIjogYXR0cmlidXRlUmVzb2x2ZXIuY3VycnkoImZyLWlkbS1waG9uZS1udW1iZXJzIiwgInZhbHVlIiwgdHJ1ZSwgZmFsc2UpLAogICAgICAgICJwaWN0dXJlIjogYXR0cmlidXRlUmVzb2x2ZXIuY3VycnkoImZyLWlkbS1waG90b3MiLCAidmFsdWUiLCB0cnVlLCBmYWxzZSksCiAgICAgICAgInByZWZlcnJlZF91c2VybmFtZSI6IGJhc2ljUmVzb2x2ZXIuY3VycnkoInVzZXJOYW1lIiksCiAgICAgICAgInByb2ZpbGUiOiBiYXNpY1Jlc29sdmVyLmN1cnJ5KCJmci1pZG0tcHJvZmlsZS11cmwiKSwKICAgICAgICAidGl0bGUiOiBiYXNpY1Jlc29sdmVyLmN1cnJ5KCJmci1pZG0tdGl0bGUiKSwKICAgICAgICAidXBkYXRlZF9hdCI6IGRhdGVSZXNvbHZlci5jdXJyeSgibW9kaWZ5VGltZXN0YW1wIiksCiAgICAgICAgInVzZXJuYW1lIjogYmFzaWNSZXNvbHZlci5jdXJyeSgidXNlck5hbWUiKSwKICAgICAgICAid2Vic2l0ZSI6IGJhc2ljUmVzb2x2ZXIuY3VycnkoImZyLWlkbS13ZWJzaXRlIiksCiAgICAgICAgInpvbmVpbmZvIjogYmFzaWNSZXNvbHZlci5jdXJyeSgiZnItaWRtLXRpbWV6b25lIiksCl0KCi8vIC0tLS0tLS0tLS0tLS0tIFVQREFURSBUSElTIFRPIENIQU5HRSBTQ09QRSBUTyBDTEFJTSBNQVBQSU5HUyAtLS0tLS0tLS0tLS0tLQovKgogKiBNYXAgb2Ygc2NvcGVzIHRvIGNsYWltIG9iamVjdHMuCiAqLwovLyB7c2NvcGV9OiBbIHtjbGFpbX0sIC4uLiBdCi8vIGh0dHBzOi8vdHJlbGxvLmNvbS9jL3dIQTNlYnAxLzEwMjEtaWQtdG9rZW4tYW5kLXVzZXJpbmZvLWVuZHBvaW50LW5vdC1yZXR1cm5pbmctYWxsLXVzZXItZGF0YQpzY29wZUNsYWltc01hcCA9IFsKICAgICAgICAiZW1haWwiOiBbICJlbWFpbCIgXSwKICAgICAgICAiYWRkcmVzcyI6IFsgImFkZHJlc3MiIF0sCiAgICAgICAgInBob25lIjogWyAicGhvbmUiIF0sCiAgICAgICAgInByb2ZpbGUiOiBbCiAgICAgICAgICAgICJiaXJ0aGRhdGUiLAogICAgICAgICAgICAiZmFtaWx5X25hbWUiLAogICAgICAgICAgICAiZ2VuZGVyIiwKICAgICAgICAgICAgImdpdmVuX25hbWUiLAogICAgICAgICAgICAibG9jYWxlIiwKICAgICAgICAgICAgIm5hbWUiLAogICAgICAgICAgICAibmlja25hbWUiLAogICAgICAgICAgICAicGljdHVyZSIsCiAgICAgICAgICAgICJwcmVmZXJyZWRfdXNlcm5hbWUiLAogICAgICAgICAgICAicHJvZmlsZSIsCiAgICAgICAgICAgICJ0aXRsZSIsCiAgICAgICAgICAgICJ1cGRhdGVkX2F0IiwKICAgICAgICAgICAgInVzZXJuYW1lIiwKICAgICAgICAgICAgIndlYnNpdGUiLAogICAgICAgICAgICAiem9uZWluZm8iLAogICAgICAgIF0KXQoKLy8gLS0tLS0tLS0tLS0tLS0tLSBVUERBVEUgQkVMT1cgRk9SIEFEVkFOQ0VEIFVTQUdFUyAtLS0tLS0tLS0tLS0tLS0tLS0tCmlmIChsb2dnZXIubWVzc2FnZUVuYWJsZWQoKSkgewogICAgc2NvcGVzLmZpbmRBbGwgeyBzIC0+ICEoIm9wZW5pZCIuZXF1YWxzKHMpIHx8IHNjb3BlQ2xhaW1zTWFwLmNvbnRhaW5zS2V5KHMpKSB9LmVhY2ggeyBzIC0+CiAgICAgICAgbG9nZ2VyLm1lc3NhZ2UoIk9wZW5BTVNjb3BlVmFsaWRhdG9yLmdldFVzZXJJbmZvKCk6Ok1lc3NhZ2U6IHNjb3BlIG5vdCBib3VuZCB0byBjbGFpbXM6ICRzIikKICAgIH0KfQoKLyoKICogQ29tcHV0ZXMgdGhlIGNsYWltcyByZXR1cm4ga2V5IGFuZCB2YWx1ZS4gVGhlIGtleSBtYXkgYmUgYSBkaWZmZXJlbnQgdmFsdWUgaWYgdGhlIGNsYWltIHZhbHVlIGlzIG5vdCBpbgogKiB0aGUgcmVxdWVzdGVkIGxhbmd1YWdlLgogKi8KZGVmIGNvbXB1dGVDbGFpbSA9IHsgY2xhaW0gLT4KICAgIHRyeSB7CiAgICAgICAgY2xhaW1SZXNvbHZlciA9IGNsYWltQXR0cmlidXRlcy5nZXQoY2xhaW0uZ2V0TmFtZSgpLCB7IGNsYWltT2JqLCBpZGVudGl0eSAtPiBkZWZhdWx0Q2xhaW1SZXNvbHZlcihjbGFpbSl9KQogICAgICAgIGNsYWltUmVzb2x2ZXIoY2xhaW0sIGlkZW50aXR5KQogICAgfSBjYXRjaCAoSWRSZXBvRXhjZXB0aW9uIGUpIHsKICAgICAgICBpZiAobG9nZ2VyLndhcm5pbmdFbmFibGVkKCkpIHsKICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoIk9wZW5BTVNjb3BlVmFsaWRhdG9yLmdldFVzZXJJbmZvKCk6IFVuYWJsZSB0byByZXRyaWV2ZSBhdHRyaWJ1dGU9JGF0dHJpYnV0ZSIsIGUpOwogICAgICAgIH0KICAgIH0gY2F0Y2ggKFNTT0V4Y2VwdGlvbiBlKSB7CiAgICAgICAgaWYgKGxvZ2dlci53YXJuaW5nRW5hYmxlZCgpKSB7CiAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKCJPcGVuQU1TY29wZVZhbGlkYXRvci5nZXRVc2VySW5mbygpOiBVbmFibGUgdG8gcmV0cmlldmUgYXR0cmlidXRlPSRhdHRyaWJ1dGUiLCBlKTsKICAgICAgICB9CiAgICB9Cn0KCi8qCiAqIENvbnZlcnRzIHJlcXVlc3RlZCBzY29wZXMgaW50byBjbGFpbSBvYmplY3RzIGJhc2VkIG9uIHRoZSBzY29wZSBtYXBwaW5ncyBpbiBzY29wZUNsYWltc01hcC4KICovCmRlZiBjb252ZXJ0U2NvcGVUb0NsYWltcyA9IHsKICAgIHNjb3Blcy5maW5kQWxsIHsgc2NvcGUgLT4gIm9wZW5pZCIgIT0gc2NvcGUgJiYgc2NvcGVDbGFpbXNNYXAuY29udGFpbnNLZXkoc2NvcGUpIH0uY29sbGVjdE1hbnkgeyBzY29wZSAtPgogICAgICAgIHNjb3BlQ2xhaW1zTWFwLmdldChzY29wZSkuY29sbGVjdCB7IGNsYWltIC0+CiAgICAgICAgICAgIG5ldyBDbGFpbShjbGFpbSkKICAgICAgICB9CiAgICB9Cn0KCi8vIENyZWF0ZXMgYSBmdWxsIGxpc3Qgb2YgY2xhaW1zIHRvIHJlc29sdmUgZnJvbSByZXF1ZXN0ZWQgc2NvcGVzLCBjbGFpbXMgcHJvdmlkZWQgYnkgQVMgYW5kIHJlcXVlc3RlZCBjbGFpbXMKZGVmIGNsYWltc1RvUmVzb2x2ZSA9IGNvbnZlcnRTY29wZVRvQ2xhaW1zKCkgKyBjbGFpbU9iamVjdHMgKyByZXF1ZXN0ZWRUeXBlZENsYWltcwoKLy8gQ29tcHV0ZXMgdGhlIGNsYWltIHJldHVybiBrZXkgYW5kIHZhbHVlcyBmb3IgYWxsIHJlcXVlc3RlZCBjbGFpbXMKY29tcHV0ZWRDbGFpbXMgPSBjbGFpbXNUb1Jlc29sdmUuY29sbGVjdEVudHJpZXMoKSB7IGNsYWltIC0+CiAgICBjb21wdXRlQ2xhaW0oY2xhaW0pCn0KCi8vIENvbXB1dGVzIGNvbXBvc2l0ZSBzY29wZXMKZGVmIGNvbXBvc2l0ZVNjb3BlcyA9IHNjb3BlQ2xhaW1zTWFwLmZpbmRBbGwgeyBzY29wZSAtPgogICAgc2NvcGVzLmNvbnRhaW5zKHNjb3BlLmtleSkKfQoKcmV0dXJuIG5ldyBVc2VySW5mb0NsYWltcygoTWFwKWNvbXB1dGVkQ2xhaW1zLCAoTWFwKWNvbXBvc2l0ZVNjb3Blcyk=",
    "default": true,
    "language": "GROOVY",
    "context": "OIDC_CLAIMS",
    "createdBy": "id=dsameuser,ou=user,dc=openam,dc=forgerock,dc=org",
    "creationDate": 1433147666269,
    "lastModifiedBy": "id=dsameuser,ou=user,dc=openam,dc=forgerock,dc=org",
    "lastModifiedDate": 1433147666269
  }
}
