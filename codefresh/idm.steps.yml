version: "1"
steps:
  main_clone:
    title: 'Cloning main repository...'
    type: git-clone
    repo: '${{CF_REPO_OWNER}}/${{CF_REPO_NAME}}'
    revision: '${{CF_REVISION}}'
    git: github-fr-saas-codefresh
  build:
    title: "Building IDM Docker Image"
    type: "build"
    working_directory: forgecloud/default/idm/
    image_name: "gcr.io/fr-saas-registry/idm"
    tag: "${{CF_BRANCH_TAG_NORMALIZED}}"
    dockerfile: "Dockerfile"
  push:
    title: "Pushing to Docker Registry"
    type: "push"
    image_name: "fr-saas-registry/idm"
    registry: "gcr"
    candidate: "${{build}}"
    tags:
      - "${{CF_BRANCH_TAG_NORMALIZED}}"
      - "${{CF_BRANCH_TAG_NORMALIZED}}-${{CF_SHORT_REVISION}}"
